import{Q}from"./QInnerLoading.817d442a.js";import{Q as S}from"./QPage.bcc29a0e.js";import{u as C}from"./index.53176d0e.js";import{d as P,_ as q,D as o,J as l,F as B,aq as M,H as a,j as s,N as y,I as m,K as N,r,B as F,C as d,E as h,G as n,P as k,Q as _,M as $,L as U,A}from"./index.e3bb839c.js";import{a as v}from"./index.ad5a5923.js";import{M as D}from"./MainTitleComp.e5291e42.js";import{Q as z}from"./QCard.ecc37e14.js";import{I as E}from"./ImageComp.46f71368.js";import{L as R}from"./ListComp.e7fdee06.js";import{E as I}from"./EmptyComp.f6009f5c.js";import{P as O}from"./PaginationComp.05309bd3.js";import"./use-transition.ef594146.js";import"./axios.70926cff.js";import"./QCardSection.d70113f2.js";import"./QCardActions.ac1a2785.js";import"./QDialog.b86ce403.js";import"./focusout.1ff9a27a.js";import"./focus-manager.32f8d49a.js";import"./ClosePopup.25aa6c51.js";import"./QImg.4d2abf6d.js";import"./QInput.01d67d73.js";import"./use-form.3b78d9ef.js";import"./format.801e7424.js";const T=P({name:"BarComp",props:{navs:{type:Array,required:!0},navValue:{type:Number,rewuired:!0}},setup:()=>({})}),j={class:"row justify-center"},G=["onClick"];function H(e,t,u,i,c,w){return o(),l("div",j,[(o(!0),l(B,null,M(e.navs,(f,p)=>(o(),l("div",{key:p},[a("div",{class:N(["pointer q-pa-md q-mx-xs",e.navValue==p?"nav-active":null]),onClick:g=>e.$emit("nav-change",p)},[s(y,{class:"q-ml-sm",name:f.item_icon},null,8,["name"]),a("span",null,m(f.item),1)],10,G)]))),128))])}var J=q(T,[["render",H],["__scopeId","data-v-746e75d4"]]);const K=P({name:"ProfileComp",components:{ImageComp:E,BarComp:J,ListComp:R,EmptyComp:I,PaginationComp:O},props:{loadedUser:Object},setup(){return{navs:r([{item:"\u0627\u0645\u0644\u0627\u06A9",item_icon:"fa fa-building"},{item:"\u062B\u0628\u062A \u062A\u0642\u0627\u0636\u0627",item_icon:"fa fa-paper-plane"}]),navValue:r(0),isRealStateOwner:r(!1),products:r([]),currentPage:r(1),pagination:r({limit:10,offset:0,total:1})}},methods:{onCopy(){navigator.clipboard.writeText(window.location.href),this.$q.notify({type:"positive",message:this.$t("success"),caption:this.$t("copyProfileURL")})},async onChangePage(e){await this.fetchData({page:e}),this.currentPage=e},async fetchData(e=[]){try{const{page:t}=e;if(t&&(this.pagination.offset=(t-1)*this.pagination.limit),this.$route.params.userId===this.user.username){const i=await v.product.productFindMyProducts({limit:this.pagination.limit,offset:this.pagination.offset,sorting:"cteaedAt: -1"});if(i.status===200){const c=i.data.data.productFindMyProducts.hits;this.products=c,this.pagination=i.data.data.productFindMyProducts.pagination}}else{const i=await v.product.productFindUserProducts({userId:this.user.id,limit:this.pagination.limit,offset:this.pagination.offset,sorting:"cteaedAt: -1"});if(i.status===200){const c=i.data.data.productFindUserProducts.hits;this.products=c,this.pagination=i.data.data.productFindUserProducts.pagination}}this.loaded=!0}catch(t){console.log(t),this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")})}}},mounted(){this.fetchData(),this.user&&this.user.permissions&&(this.isRealStateOwner=this.user.permissions.find(e=>e.codename==="write product"))},computed:{...F(C,["isUserLoggedIn","user"])}}),W={class:""},X={class:"text-center"},Y={class:"q-ma-md"},Z={class:"q-my-sm"},x={class:"text-h5"},ee={class:"text-normal",style:{opacity:"0.8"}},te=["href"],se={class:"q-px-lg q-py-xs q-mr-lg bg-green",style:{"border-radius":"25pc",color:"white"}},ae={class:"q-px-xs"},oe={key:0,class:"q-my-sm text-center"},ie=a("hr",{class:"line-style-two",style:{"margin-bottom":"0"}},null,-1),ne={key:1},re={key:2};function de(e,t,u,i,c,w){const f=d("image-comp"),p=d("bar-comp"),g=d("list-comp"),V=d("pagination-comp"),b=d("empty-comp");return o(),h(z,{flat:"",tile:""},{default:n(()=>[a("div",W,[a("div",X,[a("div",Y,[e.loadedUser.avatar_url?(o(),h(k,{key:0,size:"90px"},{default:n(()=>[s(f,{link:e.loadedUser.avatar_url,isThumb:!0},null,8,["link"])]),_:1})):(o(),h(k,{key:1,size:"90px",color:"blue-grey-2"},{default:n(()=>[s(y,{name:"person"})]),_:1}))]),a("div",Z,[a("div",x,m(e.loadedUser.name||e.loadedUser.id),1),a("div",ee,m(e.loadedUser.email),1)]),s(_,{size:"lg",class:"ad-font-color",outline:"",rounded:""},{default:n(()=>[a("span",null,m(e.loadedUser.phone),1),a("a",{class:"",href:`tel:${e.loadedUser.phone}`},[a("span",se,[s(y,{size:"sm",class:"q-px-sm",name:"fa fa-phone"})])],8,te)]),_:1}),e.isUserLoggedIn&&(e.user.id==e.loadedUser.id||e.user.is_superuser==1)?(o(),h(_,{key:0,onClick:e.onCopy,class:"q-ma-xs q-px-md ad-font-color",outline:"",rounded:""},{default:n(()=>[a("span",ae,[s(y,{name:"fa fa-copy"})]),$(" "+m(e.$t("copyProfileURL")),1)]),_:1},8,["onClick"])):U("",!0)]),e.isUserLoggedIn&&(e.user.id==e.loadedUser.id||e.user.is_superuser==1)?(o(),l("div",oe,[a("div",null,[s(_,{to:"/accounts/profile/setting/"+e.loadedUser.username,class:"q-mx-xs q-px-md",outline:"",rounded:"",dense:""},{default:n(()=>[$(m(e.$t("accountSettings")),1)]),_:1},8,["to"]),e.isRealStateOwner?(o(),h(_,{key:0,onClick:t[0]||(t[0]=()=>e.$router.push("/accounts/plus")),class:"q-mx-xs q-px-md",outline:"",rounded:"",dense:""},{default:n(()=>[$(m(e.$t("manageStates")),1)]),_:1})):U("",!0)])])):U("",!0),ie,s(p,{navs:e.navs,navValue:e.navValue,onNavChange:t[1]||(t[1]=L=>e.navValue=L)},null,8,["navs","navValue"]),e.products.length>0&&e.navValue===0?(o(),l("div",ne,[s(g,{items:e.products},null,8,["items"]),s(V,{onSelectPage:e.onChangePage,currentPage:e.currentPage,pagination:e.pagination},null,8,["onSelectPage","currentPage","pagination"])])):(o(),l("div",re,[s(b)]))])]),_:1})}var le=q(K,[["render",de]]);const pe=P({name:"ProfilePage",components:{MainTitleComp:D,ProfileComp:le,EmptyComp:I},setup(){return{loadedUser:r({}),loaded:r(!1)}},methods:{...A(C,["setUser"]),async fetchData(){try{const e=this.$route.params.userId;if(e){const t=await v.user.userFind({username:e});t.data.errors?this.$q.notify({type:"warning",message:this.$t("failed"),caption:t.data.errors[0]}):t.data.data.userFind&&(this.loadedUser=t.data.data.userFind)}else if(!e){const t=await v.auth.authFindMe();if(t.data.errors)this.$q.notify({type:"warning",message:this.$t("failed"),caption:this.$t("userNotFound")});else if(t.data.data.authFindMe.id){const u=t.data.data.authFindMe;this.loadedUser=u,this.setUser(u)}}this.loaded=!0}catch(e){const t=new Error(e);console.log(t),this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")})}}},mounted(){this.fetchData()},computed:{...F(C,["user"])}}),me={key:0},ue={key:1};function ce(e,t,u,i,c,w){const f=d("main-title-comp"),p=d("profile-comp"),g=d("empty-comp");return o(),h(S,null,{default:n(()=>[s(f,{title:e.$t("profile")},null,8,["title"]),e.loadedUser&&e.loadedUser.id?(o(),l("div",me,[s(p,{loadedUser:e.loadedUser},null,8,["loadedUser"])])):(o(),l("div",ue,[s(g)])),s(Q,{showing:!e.loaded},null,8,["showing"])]),_:1})}var Ae=q(pe,[["render",ce]]);export{Ae as default};
