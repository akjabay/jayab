import{d as v,r as n,B as b,_ as y,C as f,D as r,E as m,G as h,J as w,j as e,H as g,Q as u,K as $,N as C,M as P}from"./index.758da505.js";import{Q as j}from"./QBtnGroup.5701ca84.js";import{b as k,Q}from"./use-dark.d08f1f81.js";import{Q as _}from"./QCard.37bf516d.js";import{Q as F}from"./format.0584e0b6.js";import{L as V}from"./ListComp.d2ac8016.js";import{P as A}from"./PaginationComp.b7fd894a.js";import{E as M}from"./EmptyComp.de87cb4a.js";import{a as D}from"./index.b6409fd5.js";import{M as q}from"./MapComp.decf5a7c.js";import{F as B}from"./FilterComp.7309b231.js";import"./use-transition.f0850e0a.js";import"./QImg.92ead9aa.js";import"./QCardSection.9e482b55.js";import"./CategoryComp.e7feb518.js";import"./QInput.5c706ea3.js";import"./use-form.dadb0a3a.js";import"./focus-manager.32f8d49a.js";import"./axios.0e7880b2.js";import"./MapAddPointComp.81f183ed.js";import"./QSeparator.159b8493.js";import"./selection.31cc2582.js";import"./focusout.e509f8ae.js";import"./QItemLabel.1bcc401f.js";import"./QMenu.d44f46b3.js";import"./QDialog.49e4cb1e.js";import"./QCardActions.e5c1e1cc.js";import"./ClosePopup.27b22d3b.js";import"./ImageUploaderComp.969c6c46.js";import"./SubTitleComp.29d95159.js";import"./CityComp.e4e85926.js";const E=v({name:"ListPage",props:{filterOptions:Object},setup(){return{products:n([]),currentPage:n(1),pagination:n({limit:10,offset:0,total:1}),loaded:n(!1),filtering:n(!1)}},components:{ListComp:V,PaginationComp:A,EmptyComp:M},methods:{async onChangePage(t){await this.fetchData({page:t}),this.currentPage=t},async fetchData(t=[]){this.loaded=!1;try{const{page:i}=t;i&&(this.pagination.offset=(i-1)*this.pagination.limit);const l={};Object.keys(this.filterOptions).forEach(s=>{typeof this.filterOptions[s]=="object"&&Object.keys(this.filterOptions[s]).includes("min")?l[s]=`${this.filterOptions[s].min},${this.filterOptions[s].max}`:l[s]=this.filterOptions[s]});const o=await D.product.productFindAll({limit:this.pagination.limit,offset:this.pagination.offset,sorting:"cteaedAt: -1",categoryId:this.filterOptions.category?this.filterOptions.category.id:"",latlng:this.filterOptions.city?this.filterOptions.city.lat_long:"",...l});if(o.status===200){const s=o.data.data.productFindAll.hits;this.products=s,this.pagination=o.data.data.productFindAll.pagination}this.loaded=!0}catch(i){console.log(i),this.loaded=!0,this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")})}this.loaded=!0}},computed:{...b(k,["user"])},mounted(){}}),I={key:0},S={key:1};function L(t,i,l,o,s,d){const p=f("list-comp"),a=f("pagination-comp"),c=f("empty-comp");return r(),m(_,null,{default:h(()=>[t.products.length>0?(r(),w("div",I,[e(p,{items:t.products},null,8,["items"]),e(a,{onSelectPage:t.onChangePage,currentPage:t.currentPage,pagination:t.pagination},null,8,["onSelectPage","currentPage","pagination"])])):(r(),w("div",S,[e(c)])),e(F,{showing:!t.loaded},null,8,["showing"])]),_:1})}var N=y(E,[["render",L]]);const T=v({name:"MapPage",props:{filterOptions:Object},setup(){return{products:n([]),currentPage:n(1),pagination:n({limit:10,offset:0,total:1}),loaded:n(!1),filtering:n(!1)}},components:{MapComp:q},methods:{onChangeView({maxDistance:t,center:i}){this.fetchData({maxDistance:t,center:i})},async onChangePage(t){await this.fetchData({page:t}),this.currentPage=t},async fetchData(t=[]){try{this.loaded=!1;const{page:i,maxDistance:l=1e5,center:o}=t;i&&(this.pagination.offset=(i-1)*this.pagination.limit);const s=o?o.join(","):this.filterOptions.city?this.filterOptions.city.lat_long:this.user&&this.user.city?this.user.city.lat_long:"",d={};Object.keys(this.filterOptions).forEach(a=>{typeof this.filterOptions[a]=="object"&&Object.keys(this.filterOptions[a]).includes("min")?d[a]=`${this.filterOptions[a].min},${this.filterOptions[a].max}`:d[a]=this.filterOptions[a]});const p=await D.product.productFindAll({limit:this.pagination.limit,offset:this.pagination.offset,sorting:"cteaedAt: -1",categoryId:this.filterOptions.category?this.filterOptions.category.id:"",latlng:s,isMap:!0,maxDistance:l,...d});if(p.status===200){const a=p.data.data.productFindAll.hits;if(this.products=a,this.pagination=p.data.data.productFindAll.pagination,this.$refs.mapComponent.onAddingMarker({markers:this.products}),!o){const c=this.user&&this.user.city?this.user.city.lat_long:"",O=c?{latitude:c.split(",")[0],longitude:c.split(",")[1]}:{};this.$refs.mapComponent.setCurrentPositionMap({location:O})}}this.loaded=!0}catch(i){this.loaded=!0,console.log(i),this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")})}this.loaded=!0}},mounted(){},computed:{...b(k,["user"])}});function z(t,i,l,o,s,d){const p=f("map-comp");return r(),m(_,null,{default:h(()=>[e(p,{ref:"mapComponent",liteMode:!0,onOnChangeView:t.onChangeView},null,8,["onOnChangeView"]),e(F,{showing:!t.loaded},null,8,["showing"])]),_:1})}var G=y(T,[["render",z]]);const J=v({name:"ItemsPage",setup(){return{filtering:n(!1),view:n("list"),filterOptions:n({})}},components:{ListPage:N,MapPage:G,FilterComp:B},methods:{onResetFilter(){this.filterOptions={},this.$refs.filterComp.resetState()},onChangeFilter(t){this.filterOptions=t},onClickToView(t){this.view!==t&&(this.view=this.view==="list"?"map":"list",this.$router.replace("/items/"+this.view),this.$nextTick(function(){this.fetchData()}))},fetchData(){this.view==="list"?this.$refs.listComp.fetchData():this.view==="map"&&this.$refs.mapComp.fetchData()}},computed:{},mounted(){const t=this.$route.params.view;["list","map"].includes(t)&&(this.view=t);const i=this.$route.query.filterOptions;if(i){const l=JSON.parse(i);Object.keys(l).forEach(o=>{this.filterOptions[o]=l[o]})}this.fetchData()}}),R={class:"row justify-center q-my-sm"},H=g("div",{class:"col-md-2 col-sm-2 col-xs-2"},null,-1),K={class:"col-md-8 col-sm-8 col-xs-8 text-center"},U={key:0},W={class:"row"};function X(t,i,l,o,s,d){const p=f("filter-comp"),a=f("list-page"),c=f("map-page");return r(),m(_,null,{default:h(()=>[g("div",R,[H,g("div",K,[e(j,{push:"",class:""},{default:h(()=>[e(u,{outline:t.view==="list",class:$(t.view==="list"?"ad-font-color":""),onClick:i[0]||(i[0]=O=>t.onClickToView("list")),label:t.$t("list"),icon:"list"},null,8,["outline","class","label"]),e(u,{outline:t.view==="map",class:$(t.view==="map"?"ad-font-color":""),onClick:i[1]||(i[1]=O=>t.onClickToView("map")),label:t.$t("map"),icon:"map"},null,8,["outline","class","label"])]),_:1})]),g("div",{class:$(["col-md-2 col-sm-2 col-xs-2",t.$t("direction")==="rtl"?"text-left":"text-right"])},[e(u,{onClick:i[2]||(i[2]=O=>t.filtering=!t.filtering),outline:"",class:"ad-font-color q-mx-xs","no-caps":""},{default:h(()=>[t.filtering?(r(),m(C,{key:0,class:"",size:"1.3em",name:"fas fa-caret-up"})):(r(),m(C,{key:1,class:"",size:"1.3em",name:"fa fa-filter"}))]),_:1})],2)]),t.filtering?(r(),w("div",U,[e(p,{ref:"filterComp",onOnChangeFilter:t.onChangeFilter,filterOptions:t.filterOptions},null,8,["onOnChangeFilter","filterOptions"]),g("div",W,[e(Q),e(u,{onClick:t.onResetFilter,outline:"",class:"q-ma-xs ad-font-color",label:t.$t("clean"),"no-caps":""},null,8,["onClick","label"]),e(u,{onClick:t.fetchData,class:"q-ma-xs ad-primary-btn",label:t.$t("search"),"no-caps":""},{default:h(()=>[e(C,{class:"q-pr-md",name:"fa fa-magnifying-glass"})]),_:1},8,["onClick","label"])])])):P("",!0),t.view==="list"?(r(),m(a,{key:1,ref:"listComp",filterOptions:t.filterOptions},null,8,["filterOptions"])):t.view==="map"?(r(),m(c,{key:2,ref:"mapComp",filterOptions:t.filterOptions},null,8,["filterOptions"])):P("",!0)]),_:1})}var Dt=y(J,[["render",X]]);export{Dt as default};
