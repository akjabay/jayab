import{a as D,Q as M}from"./QCard.37bf516d.js";import{M as N}from"./MainTitleComp.b5d88647.js";import{S as Q}from"./SubTitleComp.29d95159.js";import{l as x,y as F,h as O,ac as j,d as T,r as m,B as z,A,_ as H,C as g,D as k,J as Y,H as a,E,G as u,j as i,N as G,Q as q,I as U,K as B,L as C,O as J,aS as K}from"./index.758da505.js";import{Q as P}from"./QSeparator.159b8493.js";import{Q as v}from"./QInput.5c706ea3.js";import{Q as R,D as W}from"./DarkComp.7d152935.js";import{b as S}from"./use-dark.d08f1f81.js";import{a as b}from"./index.b6409fd5.js";import{C as X}from"./CityComp.e4e85926.js";import{I as Z}from"./ImageUploaderComp.969c6c46.js";import"./use-form.dadb0a3a.js";import"./focus-manager.32f8d49a.js";import"./QBtnGroup.5701ca84.js";import"./QMenu.d44f46b3.js";import"./selection.31cc2582.js";import"./focusout.e509f8ae.js";import"./use-transition.f0850e0a.js";import"./QToggle.ad15b1a4.js";import"./axios.0e7880b2.js";import"./QCardSection.9e482b55.js";import"./format.0584e0b6.js";import"./QCardActions.e5c1e1cc.js";import"./QDialog.49e4cb1e.js";import"./QImg.92ead9aa.js";var ee=x({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(e,{slots:t,emit:$}){let c=!1,f,y,r=null,n=null,l,o;function w(){f&&f(),f=null,c=!1,r!==null&&(clearTimeout(r),r=null),n!==null&&(clearTimeout(n),n=null),y!==void 0&&y.removeEventListener("transitionend",l),l=null}function V(s,d,p){d!==void 0&&(s.style.height=`${d}px`),s.style.transition=`height ${e.duration}ms cubic-bezier(.25, .8, .50, 1)`,c=!0,f=p}function I(s,d){s.style.overflowY=null,s.style.height=null,s.style.transition=null,w(),d!==o&&$(d)}function L(s,d){let p=0;y=s,c===!0?(w(),p=s.offsetHeight===s.scrollHeight?0:void 0):(o="hide",s.style.overflowY="hidden"),V(s,p,d),r=setTimeout(()=>{r=null,s.style.height=`${s.scrollHeight}px`,l=h=>{n=null,(Object(h)!==h||h.target===s)&&I(s,"show")},s.addEventListener("transitionend",l),n=setTimeout(l,e.duration*1.1)},100)}function _(s,d){let p;y=s,c===!0?w():(o="show",s.style.overflowY="hidden",p=s.scrollHeight),V(s,p,d),r=setTimeout(()=>{r=null,s.style.height=0,l=h=>{n=null,(Object(h)!==h||h.target===s)&&I(s,"hide")},s.addEventListener("transitionend",l),n=setTimeout(l,e.duration*1.1)},100)}return F(()=>{c===!0&&w()}),()=>O(j,{css:!1,appear:e.appear,onEnter:L,onLeave:_},t.default)}});const te=T({name:"UserEditComp",components:{SubTitleComp:Q,CityComp:X,ImageUploaderComp:Z},setup(){return{editingUser:m({name:"",username:"",usernameHint:"",address:"",commissionPercentage:"",commissionLimit:"",commissionExpire:"",password:"",confirmPassword:"",city:{}}),images:m([]),imageBoxs:m([]),city:m({}),provinces:m([]),rules:m({}),editPassBox:m(!1),loading:m(!1)}},computed:{...z(S,["user"])},watch:{"editingUser.username":function(){this.checkUsername()}},methods:{...A(S,["setUser","setToken"]),onSelectCity(e){this.city=e,this.editingUser.city=this.city},async onEdit(){this.loading=!0;try{if(this.editingUser.password&&this.editingUser.confirmPassword&&this.editingUser.password!==this.editingUser.confirmPassword)return this.loading=!1,this.$q.notify({type:"negative",message:this.$t("passwordIsNotMatch"),caption:this.$t("failed")});const e=await b.auth.authUpdate({avatar_url:this.images&&this.images.length>0?this.images[0]:"",name:this.editingUser.name,username:this.editingUser.username,address:this.editingUser.address,cityId:this.editingUser.city?this.editingUser.city.id:"",commissionPercentage:this.editingUser.commissionPercentage,commissionLimit:this.editingUser.commissionLimit,commissionExpire:this.editingUser.commissionExpire,password:this.editingUser.password});e.data.errors?(this.loading=!1,this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")})):e.data.data.authUpdate.id?(this.editingUser=e.data.data.authUpdate,this.setUser(this.editingUser),this.$q.notify({type:"positive",message:this.$t("success"),caption:this.$t("success")}),this.loading=!1):this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")})}catch(e){console.log(e,"error on fecth data"),this.loading=!1,this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")})}this.loading=!1},checkUsername:async function(){try{this.editingUser.usernameHint="";const e=await b.auth.authCheckUsername({username:this.editingUser.username});e.data.errors?this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")}):e.data.data.authCheckUsername===!0?this.editingUser.usernameHint="\u0646\u0627\u0645 \u06A9\u0627\u0631\u0628\u0631\u06CC \u062A\u06A9\u0631\u0627\u0631\u06CC \u0627\u0633\u062A":e.data.data.authCheckUsername===!1&&(this.editingUser.usernameHint="\u0646\u0627\u0645 \u06A9\u0627\u0631\u0628\u0631\u06CC \u0645\u0648\u0631\u062F \u062A\u0627\u06CC\u06CC\u062F \u0627\u0633\u062A")}catch(e){const t=new Error(e);console.log(t),this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")})}},async fetchData(){try{const e=await b.auth.authFindMe();e.data.errors?this.$q.notify({type:"warning",message:this.$t("failed"),caption:e.data.errors[0]}):e.data.data.authFindMe&&(this.editingUser=e.data.data.authFindMe,this.editingUser.avatar_url&&this.imageBoxs.push(this.editingUser.avatar_url),this.city=this.editingUser.city?this.editingUser.city:{});const t=await b.main.getProvinces();if(t.status===200){const $=t.data.data;this.provinces=$}}catch(e){const t=new Error(e);console.log(t),this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")})}}},mounted(){this.rules={required:e=>!!e||this.$t("required"),min3:e=>!e||e.length>=3||this.$t("min3Character"),min8:e=>!e||e.length>=8||this.$t("min8Character"),email:(e,t)=>t.email(e)||this.$t("havetoBeValidEmail")},this.fetchData()}}),se={class:"row q-mt-xl"},ie={class:"col-12 col-md-10 col-sm-10 text-center"},oe={class:"row justify-center"},ae={class:"row text-center"},ne={class:"q-ma-md"},le={class:"col-12 col-md-10 col-sm-10 text-center"},re={class:"row q-py-sm q-mx-sm"},de={class:"col-12 col-md-6 col-sm-6 col-xs-10 q-px-md text-center"},me={class:"col-12 col-md-6 col-sm-6 col-xs-10 q-px-md text-center"},ue={class:"col-12 col-md-6 col-sm-6 col-xs-10 q-px-md text-center"},ce={class:"col-12 col-md-6 col-sm-10 col-xs-10"},pe={class:"col-12 col-md-10 col-sm-10"},he={class:"row"},ge={class:"col-12 col-md-8 col-sm-8 col-xs-8 q-px-md q-mx-md"};function fe(e,t,$,c,f,y){const r=g("image-uploader-comp"),n=g("city-comp"),l=g("sub-title-comp");return k(),Y("div",se,[a("div",ie,[a("div",oe,[e.imageBoxs.length>0?(k(),E(r,{key:0,fetchedImage:e.imageBoxs[0],circleBorder:!0,boxLength:1,onImageInputs:t[0]||(t[0]=o=>e.images=[o]),onRemoveImageInput:t[1]||(t[1]=()=>e.images=[]),onDeleteImageBox:t[2]||(t[2]=()=>e.imageBoxs=[]),imageIdx:"1"},null,8,["fetchedImage"])):(k(),E(D,{key:1,flat:"",style:{width:"100px"},class:"q-ma-xs q-py-md q-px-sm text-center"},{default:u(()=>[a("div",ae,[i(q,{class:"text-center",round:"",size:"xl",onClick:t[3]||(t[3]=o=>e.imageBoxs.push(`${Math.floor(Math.random()*1e6)}`))},{default:u(()=>[i(G,{name:"mdi-plus"})]),_:1})])]),_:1}))]),a("div",ne,U(e.editingUser.name),1),a("div",{class:B(["full-width",e.$t("direction")==="rtl"?"text-left":"text-right"])},[i(q,{loading:e.loading,outline:"",onClick:e.onEdit,class:"q-mt-sm q-mx-sm ad-font-color"},{default:u(()=>[C(U(e.$t("submitChanges")),1)]),_:1},8,["loading","onClick"])],2),i(P,{class:"q-my-md"})]),a("div",le,[a("div",re,[a("div",de,[i(v,{outlined:"",dense:"",class:"q-mt-sm",modelValue:e.editingUser.name,"onUpdate:modelValue":t[4]||(t[4]=o=>e.editingUser.name=o),rules:[e.rules.min3],label:e.$t("inputName")},null,8,["modelValue","rules","label"])]),a("div",me,[i(v,{outlined:"",dense:"",class:"q-mt-sm",modelValue:e.editingUser.username,"onUpdate:modelValue":t[5]||(t[5]=o=>e.editingUser.username=o),rules:[e.rules.min3],label:e.$t("inputUsername")},{hint:u(()=>[C(U(e.editingUser.usernameHint),1)]),_:1},8,["modelValue","rules","label"])]),a("div",ue,[i(v,{outlined:"",dense:"",class:"q-mt-sm",modelValue:e.editingUser.address,"onUpdate:modelValue":t[6]||(t[6]=o=>e.editingUser.address=o),rules:[e.rules.min8],label:e.$t("address")},null,8,["modelValue","rules","label"])]),a("div",ce,[i(n,{items:e.provinces,item:e.city,onOnSelectItem:e.onSelectCity},null,8,["items","item","onOnSelectItem"])])]),a("div",{class:B(["full-width",e.$t("direction")==="rtl"?"text-left":"text-right"])},[i(q,{loading:e.loading,outline:"",onClick:e.onEdit,class:"q-mt-sm q-mx-sm ad-font-color"},{default:u(()=>[C(U(e.$t("submitChanges")),1)]),_:1},8,["loading","onClick"])],2),i(P,{class:"q-my-md"})]),a("div",pe,[i(l,{title:e.$t("changePassword")},null,8,["title"]),i(R,{"no-caps":"",depressed:"",class:"ad-primary-btn q-ma-md",unelevated:"",onClick:t[7]||(t[7]=o=>e.editPassBox=!e.editPassBox),label:e.$t("changePassword")},null,8,["label"]),a("div",he,[i(ee,null,{default:u(()=>[J(a("div",ge,[i(v,{outlined:"",dense:"",class:"q-mt-sm",modelValue:e.editingUser.password,"onUpdate:modelValue":t[8]||(t[8]=o=>e.editingUser.password=o),rules:[e.rules.min8],type:"password",label:e.$t("inputPassword")},null,8,["modelValue","rules","label"]),i(v,{outlined:"",dense:"",class:"q-mt-sm",modelValue:e.editingUser.confirmPassword,"onUpdate:modelValue":t[9]||(t[9]=o=>e.editingUser.confirmPassword=o),rules:[e.rules.min8],type:"password",label:e.$t("inputConfirmPassword")},null,8,["modelValue","rules","label"])],512),[[K,e.editPassBox]])]),_:1}),a("div",{class:B(["full-width",e.$t("direction")==="rtl"?"text-left":"text-right"])},[i(q,{loading:e.loading,outline:"",onClick:e.onEdit,class:"q-mt-sm q-mx-sm ad-font-color"},{default:u(()=>[C(U(e.$t("submitChanges")),1)]),_:1},8,["loading","onClick"])],2)]),i(P,{class:"q-my-md"})])])}var ye=H(te,[["render",fe]]);const $e=T({name:"ProfileSettingPage",components:{MainTitleComp:N,SubTitleComp:Q,UserEditComp:ye,DarkComp:W},setup(){return{}},methods:{},mounted(){}});function Ue(e,t,$,c,f,y){const r=g("main-title-comp"),n=g("sub-title-comp"),l=g("dark-comp"),o=g("user-edit-comp");return k(),E(M,{class:""},{default:u(()=>[i(r,{title:e.$t("editUser")},null,8,["title"]),i(n,{title:e.$t("settings")},null,8,["title"]),i(l),i(n,{title:e.$t("edit")},null,8,["title"]),i(o)]),_:1})}var Ae=H($e,[["render",Ue]]);export{Ae as default};
