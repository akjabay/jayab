import{Q as M}from"./QPage.22378cf4.js";import{M as N}from"./MainTitleComp.e992e00d.js";import{S}from"./SubTitleComp.385bd45c.js";import{l as O,y as F,h as j,ab as z,d as L,r as u,B as A,A as Y,_ as T,C as f,D as P,J as G,H as n,E as B,G as m,j as s,N as J,Q as q,I as $,K as C,M as w,O as K,aO as R}from"./index.92eb8bda.js";import{Q as W}from"./QCard.6a86b0c3.js";import{Q as V}from"./QSeparator.1669020d.js";import{Q as c}from"./QInput.12ca7d0b.js";import{Q as X,D as Z}from"./DarkComp.70867288.js";import{u as Q}from"./use-dark.ecf38b9d.js";import{a as k}from"./index.191899c2.js";import{C as x}from"./CityComp.d0d8ac6d.js";import{I as _}from"./ImageUploaderComp.9277cdeb.js";import"./use-form.c87ee303.js";import"./focus-manager.32f8d49a.js";import"./QBtnGroup.fb2721f3.js";import"./selection.aecaed73.js";import"./focusout.7593105c.js";import"./use-transition.76624cdd.js";import"./QToggle.cb4ae876.js";import"./axios.a466877b.js";import"./QCardSection.b00a13b0.js";import"./format.801e7424.js";import"./QCardActions.b7f8084b.js";import"./QDialog.081ad832.js";import"./QImg.19909024.js";var ee=O({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(e,{slots:t,emit:v}){let p=!1,y,U,r=null,l=null,a,o;function b(){y&&y(),y=null,p=!1,r!==null&&(clearTimeout(r),r=null),l!==null&&(clearTimeout(l),l=null),U!==void 0&&U.removeEventListener("transitionend",a),a=null}function E(i,d,h){d!==void 0&&(i.style.height=`${d}px`),i.style.transition=`height ${e.duration}ms cubic-bezier(.25, .8, .50, 1)`,p=!0,y=h}function I(i,d){i.style.overflowY=null,i.style.height=null,i.style.transition=null,b(),d!==o&&v(d)}function D(i,d){let h=0;U=i,p===!0?(b(),h=i.offsetHeight===i.scrollHeight?0:void 0):(o="hide",i.style.overflowY="hidden"),E(i,h,d),r=setTimeout(()=>{r=null,i.style.height=`${i.scrollHeight}px`,a=g=>{l=null,(Object(g)!==g||g.target===i)&&I(i,"show")},i.addEventListener("transitionend",a),l=setTimeout(a,e.duration*1.1)},100)}function H(i,d){let h;U=i,p===!0?b():(o="show",i.style.overflowY="hidden",h=i.scrollHeight),E(i,h,d),r=setTimeout(()=>{r=null,i.style.height=0,a=g=>{l=null,(Object(g)!==g||g.target===i)&&I(i,"hide")},i.addEventListener("transitionend",a),l=setTimeout(a,e.duration*1.1)},100)}return F(()=>{p===!0&&b()}),()=>j(z,{css:!1,appear:e.appear,onEnter:D,onLeave:H},t.default)}});const te=L({name:"UserEditComp",components:{SubTitleComp:S,CityComp:x,ImageUploaderComp:_},setup(){return{editingUser:u({name:"",username:"",usernameHint:"",address:"",commissionPercentage:"",commissionLimit:"",commissionExpire:"",password:"",confirmPassword:"",city:{}}),images:u([]),imageBoxs:u([]),city:u({}),provinces:u([]),rules:u({}),editPassBox:u(!1),loading:u(!1)}},computed:{...A(Q,["user"])},watch:{"editingUser.username":function(){this.checkUsername()}},methods:{...Y(Q,["setUser","setToken"]),onSelectCity(e){this.city=e,this.editingUser.city=this.city},async onEdit(){this.loading=!0;try{if(this.editingUser.password&&this.editingUser.password!=this.editingUser.confirmPassword)return this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")});const e=await k.auth.authUpdate({avatar_url:this.images&&this.images.length>0?this.images[0]:"",name:this.editingUser.name,username:this.editingUser.username,address:this.editingUser.address,cityId:this.editingUser.city?this.editingUser.city.id:"",commissionPercentage:this.editingUser.commissionPercentage,commissionLimit:this.editingUser.commissionLimit,commissionExpire:this.editingUser.commissionExpire,password:this.editingUser.password});e.data.errors?this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")}):e.data.data.authUpdate.id?(this.editingUser=e.data.data.authUpdate,this.setUser(this.editingUser),this.$q.notify({type:"positive",message:this.$t("success"),caption:this.$t("success")})):this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")})}catch(e){console.log(e,"error on fecth data"),this.loading=!1,this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")})}this.loading=!1},checkUsername:async function(){try{this.editingUser.usernameHint="";const e=await k.auth.authCheckUsername({username:this.editingUser.username});e.data.errors?this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")}):e.data.data.authCheckUsername===!0?this.editingUser.usernameHint="\u0646\u0627\u0645 \u06A9\u0627\u0631\u0628\u0631\u06CC \u062A\u06A9\u0631\u0627\u0631\u06CC \u0627\u0633\u062A":e.data.data.authCheckUsername===!1&&(this.editingUser.usernameHint="\u0646\u0627\u0645 \u06A9\u0627\u0631\u0628\u0631\u06CC \u0645\u0648\u0631\u062F \u062A\u0627\u06CC\u06CC\u062F \u0627\u0633\u062A")}catch(e){const t=new Error(e);console.log(t),this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")})}},async fetchData(){try{const e=await k.auth.authFindMe();e.data.errors?this.$q.notify({type:"warning",message:this.$t("failed"),caption:e.data.errors[0]}):e.data.data.authFindMe&&(this.editingUser=e.data.data.authFindMe,this.editingUser.avatar_url&&this.imageBoxs.push(this.editingUser.avatar_url),this.city=this.editingUser.city?this.editingUser.city:{});const t=await k.main.getProvinces();if(t.status===200){const v=t.data.data;this.provinces=v}}catch(e){const t=new Error(e);console.log(t),this.$q.notify({type:"negative",message:this.$t("failed"),caption:this.$t("failed")})}}},mounted(){this.rules={required:e=>!!e||this.$t("required"),min3:e=>!e||e.length>=3||this.$t("min3Character"),min8:e=>!e||e.length>=8||this.$t("min8Character"),email:(e,t)=>t.email(e)||this.$t("havetoBeValidEmail")},this.fetchData()}}),se={class:"row q-mt-xl"},ie={class:"col-12 col-md-10 col-sm-10 text-center"},oe={class:"row justify-center"},ne={class:"row text-center"},ae={class:"q-ma-md"},le={class:"col-12 col-md-10 col-sm-10 text-center"},re={class:"row q-py-sm q-mx-sm"},de={class:"col-12 col-md-6 col-sm-6 col-xs-10 q-px-md text-center"},me={class:"col-12 col-md-6 col-sm-6 col-xs-10 q-px-md text-center"},ue={class:"col-12 col-md-6 col-sm-6 col-xs-10 q-px-md text-center"},ce={class:"col-12 col-md-6 col-sm-10 col-xs-10"},pe={class:"col-12 col-md-10 col-sm-10"},he={class:"row q-my-md"},ge={class:"col-12 col-md-6 col-sm-6 col-xs-10 q-px-md"},fe={class:"col-12 col-md-10 col-sm-10"},ye={class:"row"},Ue={class:"col-12 col-md-8 col-sm-8 col-xs-8 q-px-md q-mx-md"};function $e(e,t,v,p,y,U){const r=f("image-uploader-comp"),l=f("city-comp"),a=f("sub-title-comp");return P(),G("div",se,[n("div",ie,[n("div",oe,[e.imageBoxs.length>0?(P(),B(r,{key:0,fetchedImage:e.imageBoxs[0],circleBorder:!0,boxLength:1,onImageInputs:t[0]||(t[0]=o=>e.images=[o]),onRemoveImageInput:t[1]||(t[1]=()=>e.images=[]),onDeleteImageBox:t[2]||(t[2]=()=>e.imageBoxs=[]),imageIdx:"1"},null,8,["fetchedImage"])):(P(),B(W,{key:1,flat:"",style:{width:"100px"},class:"q-ma-xs q-py-md q-px-sm text-center"},{default:m(()=>[n("div",ne,[s(q,{class:"text-center",round:"",size:"xl",onClick:t[3]||(t[3]=o=>e.imageBoxs.push(`${Math.floor(Math.random()*1e6)}`))},{default:m(()=>[s(J,{name:"mdi-plus"})]),_:1})])]),_:1}))]),n("div",ae,$(e.editingUser.name),1),n("div",{class:C(["full-width",e.$t("direction")==="rtl"?"text-left":"text-right"])},[s(q,{loading:e.loading,outline:"",onClick:e.onEdit,class:"q-mt-sm q-mx-sm ad-font-color"},{default:m(()=>[w($(e.$t("submitChanges")),1)]),_:1},8,["loading","onClick"])],2),s(V,{class:"q-my-md"})]),n("div",le,[n("div",re,[n("div",de,[s(c,{outlined:"",dense:"",class:"q-mt-sm",modelValue:e.editingUser.name,"onUpdate:modelValue":t[4]||(t[4]=o=>e.editingUser.name=o),rules:[e.rules.min3],label:e.$t("inputName")},null,8,["modelValue","rules","label"])]),n("div",me,[s(c,{outlined:"",dense:"",class:"q-mt-sm",modelValue:e.editingUser.username,"onUpdate:modelValue":t[5]||(t[5]=o=>e.editingUser.username=o),rules:[e.rules.min3],label:e.$t("inputUsername")},{hint:m(()=>[w($(e.editingUser.usernameHint),1)]),_:1},8,["modelValue","rules","label"])]),n("div",ue,[s(c,{outlined:"",dense:"",class:"q-mt-sm",modelValue:e.editingUser.address,"onUpdate:modelValue":t[6]||(t[6]=o=>e.editingUser.address=o),rules:[e.rules.min8],label:e.$t("address")},null,8,["modelValue","rules","label"])]),n("div",ce,[s(l,{items:e.provinces,item:e.city,onOnSelectItem:e.onSelectCity},null,8,["items","item","onOnSelectItem"])])]),n("div",{class:C(["full-width",e.$t("direction")==="rtl"?"text-left":"text-right"])},[s(q,{loading:e.loading,outline:"",onClick:e.onEdit,class:"q-mt-sm q-mx-sm ad-font-color"},{default:m(()=>[w($(e.$t("submitChanges")),1)]),_:1},8,["loading","onClick"])],2),s(V,{class:"q-my-md"})]),n("div",pe,[s(a,{title:e.$t("commissions")},null,8,["title"]),n("div",he,[n("div",ge,[s(c,{outlined:"",dense:"",type:"Number",class:"q-mt-sm",modelValue:e.editingUser.commissionPercentage,"onUpdate:modelValue":t[7]||(t[7]=o=>e.editingUser.commissionPercentage=o),rules:[],label:e.$t("commissionPercentage")},null,8,["modelValue","label"]),s(c,{outlined:"",dense:"",type:"Number",class:"q-mt-sm",modelValue:e.editingUser.commissionLimit,"onUpdate:modelValue":t[8]||(t[8]=o=>e.editingUser.commissionLimit=o),rules:[],label:e.$t("commissionLimit")},null,8,["modelValue","label"]),s(c,{outlined:"",dense:"",type:"Date",class:"q-mt-sm",modelValue:e.editingUser.commissionExpire,"onUpdate:modelValue":t[9]||(t[9]=o=>e.editingUser.commissionExpire=o),rules:[],label:e.$t("commissionLimit")},null,8,["modelValue","label"])])]),n("div",{class:C(["full-width",e.$t("direction")==="rtl"?"text-left":"text-right"])},[s(q,{loading:e.loading,outline:"",onClick:e.onEdit,class:"q-mt-sm q-mx-sm ad-font-color"},{default:m(()=>[w($(e.$t("submitChanges")),1)]),_:1},8,["loading","onClick"])],2),s(V,{class:"q-my-md"})]),n("div",fe,[s(a,{title:e.$t("changePassword")},null,8,["title"]),s(X,{"no-caps":"",depressed:"",class:"ad-primary-btn q-ma-md",unelevated:"",onClick:t[10]||(t[10]=o=>e.editPassBox=!e.editPassBox),label:e.$t("changePassword")},null,8,["label"]),n("div",ye,[s(ee,null,{default:m(()=>[K(n("div",Ue,[s(c,{outlined:"",dense:"",class:"q-mt-sm",modelValue:e.editingUser.password,"onUpdate:modelValue":t[11]||(t[11]=o=>e.editingUser.password=o),rules:[e.rules.min8],type:"password",label:e.$t("inputPassword")},null,8,["modelValue","rules","label"]),s(c,{outlined:"",dense:"",class:"q-mt-sm",modelValue:e.editingUser.confirmPassword,"onUpdate:modelValue":t[12]||(t[12]=o=>e.editingUser.confirmPassword=o),rules:[e.rules.min8],type:"password",label:e.$t("inputConfirmPassword")},null,8,["modelValue","rules","label"])],512),[[R,e.editPassBox]])]),_:1}),n("div",{class:C(["full-width",e.$t("direction")==="rtl"?"text-left":"text-right"])},[s(q,{loading:e.loading,outline:"",onClick:e.onEdit,class:"q-mt-sm q-mx-sm ad-font-color"},{default:m(()=>[w($(e.$t("submitChanges")),1)]),_:1},8,["loading","onClick"])],2)]),s(V,{class:"q-my-md"})])])}var ve=T(te,[["render",$e]]);const qe=L({name:"ProfileSettingPage",components:{MainTitleComp:N,SubTitleComp:S,UserEditComp:ve,DarkComp:Z},setup(){return{}},methods:{},mounted(){}});function we(e,t,v,p,y,U){const r=f("main-title-comp"),l=f("sub-title-comp"),a=f("dark-comp"),o=f("user-edit-comp");return P(),B(M,{class:""},{default:m(()=>[s(r,{title:e.$t("editUser")},null,8,["title"]),s(l,{title:e.$t("settings")},null,8,["title"]),s(a),s(l,{title:e.$t("edit")},null,8,["title"]),s(o)]),_:1})}var Re=T(qe,[["render",we]]);export{Re as default};
